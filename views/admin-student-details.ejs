<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Student Details</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css" />
    <script src="/preventBack.js"></script>
</head>
<body class="bg-light">
    
      <!-- Navbar -->
      
      <nav class="navbar common-shadow">
          <div class="container mt-0">
              <div style="display: flex; align-items: center;">
                  <a class="nav-link" href="/admin/dashboard" style="color: black;">Dashboard</a>
                  <a class="navbar-brand" href="/admin/students" style="color: #007bff; font-weight: bold;">Student Details</a>
                  <a class="nav-link" href="/admin/rooms" style="color: black;">Room Details</a>
              </div>
              <div style="display: flex; align-items: center; margin-left: auto;">
                  <span class="mr-3">Hello, Admin</span>
                  <div class="dropdown">
                      <button class="btn btn-link" type="button" id="settingsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <img src="/images/setting.png" alt="Settings" width="20" height="20">
                      </button>
                      <div class="dropdown-menu dropdown-menu-right" aria-labelledby="settingsDropdown" style="position: absolute;">
                          <a class="dropdown-item" href="#" onclick="logout()">Logout</a>
                      </div>
                  </div>
              </div>
          </div>
      </nav>
      

    <!-- Main Content -->
    <main class="container common-shadow mt-4">
        <!-- Register New Student Button -->
        <button class="btn all-btn btn-success mb-3" data-toggle="modal" data-target="#registerStudentModal">Register New Student</button>

        <!-- Filter and Search Options -->
        <div class="row mb-3">
            <div class="col-md-2">
                <label for="filterGender">Gender</label>
                <select id="filterGender" class="form-control" onchange="filterAndSearchStudents()">
                    <option value="All">All</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="filterFaculty">Faculty</label>
                <select id="filterFaculty" class="form-control" onchange="filterAndSearchStudents()">
                    <option value="All">All</option>
                    <option value="Faculty of Law (FOL)">Faculty of Law (FOL)</option>
                    <option value="Faculty of Engineering & Technology (FET)">Faculty of Engineering & Technology (FET)</option>
                    <option value="Faculty of Computing & Informatics (FCI)">Faculty of Computing & Informatics (FCI)</option>
                    <option value="Faculty of Information & Technology (FIST)">Faculty of Information & Technology (FIST)</option>
                    <option value="Faculty of Management (FCM)">Faculty of Management (FCM)</option>
                    <option value="Faculty of Business (FOB)">Faculty of Business (FOB)</option>
                    <option value="Faculty of Creative Multimedia (FCM)">Faculty of Creative Multimedia (FCM)</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="filterYear">Year of Degree</label>
                <select id="filterYear" class="form-control" onchange="filterAndSearchStudents()">
                    <option value="All">All</option>
                    <option value="FIRST">FIRST</option>
                    <option value="SECOND">SECOND</option>
                    <option value="THIRD">THIRD</option>
                    <option value="FOURTH">FOURTH</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="filterState">State of Residence</label>
                <select id="filterState" class="form-control" onchange="filterAndSearchStudents()">
                    <option value="All">All</option>
                    <option value="JOHOR">JOHOR</option>
                    <option value="KEDAH">KEDAH</option>
                    <option value="KELANTAN">KELANTAN</option>
                    <option value="MELAKA">MELAKA</option>
                    <option value="NEGERI SEMBILAN">NEGERI SEMBILAN</option>
                    <option value="PAHANG">PAHANG</option>
                    <option value="PULAU PINANG">PULAU PINANG</option>
                    <option value="PERAK">PERAK</option>
                    <option value="PERLIS">PERLIS</option>
                    <option value="SABAH">SABAH</option>
                    <option value="SARAWAK">SARAWAK</option>
                    <option value="SELANGOR">SELANGOR</option>
                    <option value="TERENGGANU">TERENGGANU</option>
                    <option value="KUALA LUMPUR">KUALA LUMPUR</option>
                    <option value="LABUAN">LABUAN</option>
                    <option value="PUTRAJAYA">PUTRAJAYA</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="filterPref">Room Preference</label>
                <select id="filterPref" class="form-control" onchange="filterAndSearchStudents()">
                    <option value="All">All</option>
                    <option value="QUIET">QUIET</option>
                    <option value="SOCIAL">SOCIAL</option>
                    <option value="FLEXIBLE">FLEXIBLE</option>
                </select>
            </div>
            <div class="col-md-2">
                <label for="searchInput">Search</label>
                <input type="text" id="searchInput" class="form-control" onkeyup="filterAndSearchStudents()" placeholder="Search...">
            </div>

        </div>
    </div>
    </main>
    <div class="container common-shadow mt-3">
        <!-- Student Details Table -->
        <div class="table-responsive">
            <table class="shadow-table table-bordered">
                <thead >
                    <tr>
                        <th>ID</th>
                        <th>Full Name</th>
                        <th>Gender</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Faculty</th>
                        <th>Year of Degree</th>
                        <th>State of Residence</th>
                        <th>Room Environment Preference</th>
                        <th>Registration Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
            </table>
            <div class="table-responsive">
                <table class="table table-striped tbl-content ">
                    <tbody id="studentTableBody">
                        <% students.forEach(function(student) { %>
                        <tr>
                            <td><%= student.std_id %></td>
                            <td><%= student.std_fullname %></td>
                            <td><%= student.std_gender %></td>
                            <td><%= student.std_email %></td>
                            <td><%= student.std_phone %></td>
                            <td><%= student.std_faculty %></td>
                            <td><%= student.std_year %></td>
                            <td><%= student.std_state %></td>
                            <td><%= student.std_pref %></td>
                            <td><%= new Date(student.reg_date).toLocaleString('en-GB', { timeZone: 'UTC', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit' }).replace(',', '') %></td>
                            <td class="text-center">
                                <button class="btn all-btn btn-success btn-sm" onclick="openEditModal('<%= student.std_id %>', '<%= student.std_fullname %>', '<%= student.std_gender %>')">Edit</button>
                                <button class="btn all-btn btn-danger btn-sm" onclick="openDeleteModal('<%= student.std_id %>', '<%= student.std_fullname %>')">Delete</button>
                            </td>
                        </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Register New Student Modal -->
        <div class="modal fade" id="registerStudentModal" tabindex="-1" role="dialog" aria-labelledby="registerStudentModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="registerStudentModalLabel">Register New Student</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form action="/admin/students/register" method="post">
                            <div class="form-group">
                                <label for="std_id">Student ID:</label>
                                <input type="text" id="std_id" name="std_id" class="form-control" placeholder="Enter Student ID" required>
                            </div>
                            <div class="form-group">
                                <label for="std_fullName">Full Name:</label>
                                <input type="text" id="std_fullName" name="std_fullName" class="form-control" placeholder="Enter Student Full Name" required>
                            </div>
                            <div class="form-group">
                                <label for="std_gender">Gender:</label>
                                <select id="std_gender" name="std_gender" class="form-control" required>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="std_password">Initial Password:</label>
                                <input type="password" id="std_password" name="std_password" class="form-control" placeholder="Enter Initial Password" required>
                            </div>
                            <div class="text-center">
                            <button type="submit" class="btn all-btn btn-success" >Register</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Student Modal -->
        <div class="modal fade" id="editStudentModal" tabindex="-1" role="dialog" aria-labelledby="editStudentModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editStudentModalLabel">Edit Student</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <form id="editStudentForm" action="/admin/students/edit" method="post">
                  <input type="hidden" id="original_std_id" name="original_std_id">
                  <div class="form-group">
                    <label for="edit_std_fullname">Full Name:</label>
                    <input type="text" id="edit_std_fullname" name="std_fullname" class="form-control" required>
                  </div>
                  <div class="form-group" id="genderField">
                    <label for="edit_std_gender">Gender:</label>
                    <select id="edit_std_gender" name="std_gender" class="form-control" required>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="edit_std_password">Reset Password:</label>
                    <input type="password" id="edit_std_password" name="std_password" class="form-control" placeholder="Enter New Password">
                  </div>
                  <div class="text-center">
                    <button type="submit" class="btn all-btn btn-success">Update Student</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>


        <!-- Delete Confirmation Modal -->
        <div class="modal fade" id="deleteStudentModal" tabindex="-1" role="dialog" aria-labelledby="deleteStudentModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteStudentModalLabel">Delete Student</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p>Are you sure you want to delete this student <strong id="delete_student_name"></strong>?</p>
                        <form id="deleteStudentForm" action="/admin/students/delete" method="post">
                            <input type="hidden" id="delete_std_id" name="std_id">
                            <div class="text-right">
                            <button type="button" class="btn all-btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn all-btn btn-danger">Delete</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </main>


    <script>
        function filterAndSearchStudents() {
            const filterGender = document.getElementById('filterGender').value;
            const filterFaculty = document.getElementById('filterFaculty').value;
            const filterYear = document.getElementById('filterYear').value;
            const filterState = document.getElementById('filterState').value;
            const filterPref = document.getElementById('filterPref').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const students = document.querySelectorAll('#studentTableBody tr');

            students.forEach(student => {
                const studentGender = student.children[2].textContent;
                const studentFaculty = student.children[5].textContent;
                const studentYear = student.children[6].textContent;
                const studentState = student.children[7].textContent;
                const studentPref = student.children[8].textContent;
                const studentText = student.textContent.toLowerCase();

                const matchGender = (filterGender === 'All' || filterGender === studentGender);
                const matchFaculty = (filterFaculty === 'All' || filterFaculty === studentFaculty);
                const matchYear = (filterYear === 'All' || filterYear === studentYear);
                const matchState = (filterState === 'All' || filterState === studentState);
                const matchPref = (filterPref === 'All' || filterPref === studentPref);
                const matchSearch = studentText.includes(searchInput);

                if (matchGender && matchFaculty && matchYear && matchState && matchPref && matchSearch) {
                    student.style.display = '';
                } else {
                    student.style.display = 'none';
                }
            });
        }

          function openEditModal(std_id, std_fullname, std_gender) {
            document.getElementById('original_std_id').value = std_id;
            document.getElementById('edit_std_fullname').value = std_fullname;
            document.getElementById('edit_std_password').value = '';
            document.getElementById('genderField').style.display = 'none';
            $('#editStudentModal').modal('show');
          }

        function openDeleteModal(std_id, std_fullname) {
            document.getElementById('delete_std_id').value = std_id;
            document.getElementById('delete_student_name').innerText = std_fullname;
            $('#deleteStudentModal').modal('show');
        }
    </script>

      <script>
        function logout() {
          window.location.href = '/logout';
        }
      </script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
